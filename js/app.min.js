let darkMode=localStorage.getItem("prefer"),mode=!0;null!==darkMode&&(darkMode="1"===darkMode),(!window.matchMedia("(prefers-color-scheme: dark)").matches||darkMode)&&(null===darkMode||darkMode)||changeTheme(!1),"serviceWorker"in navigator&&navigator.serviceWorker.register("/apps/ibge/sw.js");const quizBasic=$("#quizBasic"),quizSample=$("#quizSample"),tabLink=$(".tab-link"),formTax=$("#taxForm"),formIncome=$("#incomeForm"),formTermination=$("#terminationForm"),formAbsence=$("#absenceForm"),currency=e=>e.toLocaleString("pt-br",{style:"currency",currency:"BRL"}),taxes={1:{urban:{unit:.51,basic:{people:.9,quiz:1.21},sample:{people:1.51,quiz:1.41}},rural:{unit:.56,basic:{people:1.01,quiz:1.34},sample:{people:1.67,quiz:1.57}}},2:{urban:{unit:.56,basic:{people:1.01,quiz:1.34},sample:{people:1.67,quiz:1.57}},rural:{unit:.62,basic:{people:1.1,quiz:1.46},sample:{people:1.83,quiz:1.7}}},3:{urban:{unit:.62,basic:{people:1.1,quiz:1.46},sample:{people:1.83,quiz:1.7}},rural:{unit:.69,basic:{people:1.21,quiz:1.61},sample:{people:2.01,quiz:1.89}}},4:{urban:{unit:.69,basic:{people:1.21,quiz:1.61},sample:{people:2.01,quiz:1.89}},rural:{unit:.75,basic:{people:1.33,quiz:1.76},sample:{people:2.21,quiz:2.07}}},5:{urban:{unit:.75,basic:{people:1.33,quiz:1.76},sample:{people:2.21,quiz:2.07}},rural:{unit:.82,basic:{people:1.46,quiz:1.94},sample:{people:2.45,quiz:2.28}}},6:{urban:{unit:.82,basic:{people:1.46,quiz:1.94},sample:{people:2.45,quiz:2.28}},rural:{unit:.9,basic:{people:1.6,quiz:2.14},sample:{people:2.68,quiz:2.51}}},7:{urban:{unit:.9,basic:{people:1.6,quiz:2.14},sample:{people:2.68,quiz:2.51}},rural:{unit:1,basic:{people:1.76,quiz:2.36},sample:{people:2.94,quiz:2.76}}},8:{urban:{unit:1,basic:{people:1.94,quiz:2.6},sample:{people:3.25,quiz:3.03}},rural:{unit:1.11,basic:{people:2.01,quiz:2.67},sample:{people:3.32,quiz:3.1}}},9:{urban:{unit:1.19,basic:{people:2.33,quiz:3.12},sample:{people:3.9,quiz:3.64}},rural:{unit:1.33,basic:{people:2.42,quiz:3.2},sample:{people:3.98,quiz:3.72}}},10:{urban:{unit:1.31,basic:{people:2.56,quiz:3.43},sample:{people:4.29,quiz:4}},rural:{unit:1.46,basic:{people:2.66,quiz:3.52},sample:{people:4.38,quiz:4.09}}},11:{urban:{unit:1.44,basic:{people:2.82,quiz:3.77},sample:{people:4.72,quiz:4.4}},rural:{unit:1.61,basic:{people:2.93,quiz:3.87},sample:{people:4.82,quiz:4.5}}}};function calcINSS(e){let a={taxe:14,discount:0};return e<=1212?a.taxe=7.5:e<=2427.35?(a.taxe=9,a.discount=18.18):e<=3641.03?(a.taxe=12,a.discount=91.01):e<=7087.22?(a.taxe=14,a.discount=163):a.discount=163-7087.22*.14,e<=7087.22&&(a.discount-=e/100*a.taxe),a}function calcIRRF(e){let a={taxe:0,discount:0};return e<=1903.98?a.taxe=0:e<=2826.65?(a.taxe=7.5,a.discount=142.8):e<=3751.05?(a.taxe=15,a.discount=354.8):e<=4664.68?(a.taxe=22.5,a.discount=636.13):(a.taxe=27.5,a.discount=869.36),a.discount-=e/100*a.taxe,a}function changeTheme(e=!0){(mode=!mode)?($(".form-control").addClass("form-control-dark"),$(".form-check-input").addClass("form-check-dark"),$("body").addClass("bg-black").addClass("text-gray").removeClass("bg-light"),$(".shadow-sm").addClass("bg-dark").removeClass("bg-white"),$(".list-group-item").addClass("bg-dark").addClass("text-gray"),$(".income").addClass("text-gray"),$(".btn").addClass("btn-dark").removeClass("btn-secondary"),$(".dark-mode").addClass("bg-dark"),$(".bg-change").removeClass("bg-white"),$(".bi-moon").addClass("bi-sun").removeClass("bi-moon"),$(".input-group-text").addClass("input-group-text-dark"),$(".nav-tabs").addClass("bg-black").removeClass("bg-light"),$(".nav-tabs a").addClass("text-light").removeClass("text-black"),$(".nav-tabs a.bg-white").addClass("bg-dark").removeClass("bg-white"),e&&localStorage.setItem("prefer","1")):($(".form-control").removeClass("form-control-dark"),$(".form-check-input").removeClass("form-check-dark"),$("body").removeClass("bg-black").removeClass("text-gray").addClass("bg-light"),$(".shadow-sm").removeClass("bg-dark").addClass("bg-white"),$(".list-group-item").removeClass("bg-dark").removeClass("text-gray"),$(".income").removeClass("text-gray"),$(".btn").removeClass("btn-dark").addClass("btn-secondary"),$(".dark-mode").removeClass("bg-dark"),$(".bg-change").addClass("bg-white"),$(".bi-sun").addClass("bi-moon").removeClass("bi-sun"),$(".input-group-text").removeClass("input-group-text-dark"),$(".nav-tabs").removeClass("bg-black").addClass("bg-light"),$(".nav-tabs a").removeClass("text-light").addClass("text-black"),$(".nav-tabs a.bg-dark").removeClass("bg-dark").addClass("bg-white"),e&&localStorage.setItem("prefer","0"))}tabLink.on("hide.bs.tab",function(){mode?$(this).removeClass("bg-dark"):$(this).removeClass("bg-white")}),tabLink.on("show.bs.tab",function(){mode?$(this).addClass("bg-dark"):$(this).addClass("bg-white")}),new bootstrap.Tab($("#btnCalcIncome")).show(),quizBasic.on("change",()=>"0"===quizBasic.val()?$("#peopleBasic").val("0"):""),quizSample.on("change",()=>"0"===quizSample.val()?$("#peopleSample").val("0"):""),formIncome.on("submit",function(e){if(e.preventDefault(),this.checkValidity()){let a=Object.fromEntries(formIncome.serializeArray().map(({name:e,value:a})=>[e,a])),t=0,s=0,i,l,o=a.taxe,n={},r=a.locale,u=a.number_sons,c=$("#outRangeSalary"),m=parseInt(a.units_confirmed)+parseInt(a.units_included),p=$("#quantitySons"),d={basic:parseInt(a.quiz_basic),sample:parseInt(a.quiz_sample)},b={basic:parseInt(a.people_basic),sample:parseInt(a.people_sample)};p.removeClass("d-none"),c.addClass("d-none"),o=taxes[o][r],n.units=m*o.unit,n.quiz=d.basic*o.basic.quiz+d.sample*o.sample.quiz,n.people=b.basic*o.basic.people+b.sample*o.sample.people,s+=n.units+n.quiz+n.people,$("#units").html(m),$("#quiz").html(d.basic+d.sample),$("#people").html(b.basic+b.sample),$("#unitsValue").html(currency(n.units)),$("#quizValue").html(currency(n.quiz)),$("#peopleValue").html(currency(n.people)),$("#totalGross").html(currency(s)),s<=1655.98&&s>0?($("#quantitySonsValue").html(u),t=56.47*u):(p.addClass("d-none"),c.removeClass("d-none")),$("#familySalaryValue").html(currency(t)),i=calcINSS(s),$("#percentInss").html(i.taxe.toLocaleString("pt-br")),$("#inssValue").html(currency(i.discount)),s+=i.discount,l=calcIRRF(s),$("#percentIrrf").html(l.taxe.toLocaleString("pt-br")),$("#irrfValue").html(currency(l.discount)),s+=l.discount,s+=t,$("#incomeValue").html(currency(s)),$("#income").removeClass("d-none"),window.location.href="#income",$("#calculateBtn").html("Atualizar")}else e.stopPropagation();formIncome.addClass("was-validated")}),formTax.on("submit",function(e){e.preventDefault();let a=$("#calcTaxSuccess"),t=$("#calcTaxError");if(a.addClass("d-none"),t.addClass("d-none"),this.checkValidity()){let s=Object.fromEntries(formTax.serializeArray().map(({name:e,value:a})=>[e,a])),i=parseFloat(s.value_units),l=s.tax_locale,o=parseInt(s.units_visited),n=parseFloat((i/o).toFixed(2)),r=0;for(let u=1;u<=11;u++)if(taxes[u][l].unit===n){r=u;break}0!==r?($("#taxValue").html(r),a.removeClass("d-none")):t.removeClass("d-none"),$("#calculateTaxBtn").html("Atualizar")}else e.stopPropagation();formTax.addClass("was-validated")}),formAbsence.on("submit",function(e){if(e.preventDefault(),this.checkValidity()){let a=Object.fromEntries(formAbsence.serializeArray().map(({name:e,value:a})=>[e,a])),t=parseInt(a.domicile_occupied),s={quantity:t-parseInt(a.quiz_finalized),taxe:null},i={taxe:parseInt(a.goal_absence),quantity:null};i.quantity=t*i.taxe/100,s.taxe=parseFloat((s.quantity/t*100).toFixed());let l=s.quantity-i.quantity;$("#absenceQuantity").html(s.quantity),$("#absenceTaxe").html(s.taxe.toLocaleString("pt-br")),$("#goalAbsenceQuantity").html(i.quantity.toLocaleString("pt-br")),$("#goalAbsenceDiff").html(l>0?Math.ceil(l):0),$("#absenceDetails").removeClass("d-none"),window.location.href="#absenceDetails",$("#calculateAbsenceBtn").html("Atualizar")}else e.stopPropagation();formAbsence.addClass("was-validated")}),formTermination.on("submit",function(e){if(e.preventDefault(),this.checkValidity()){let a=$("#calcTerminationError"),t=$("#incomeTermination");a.addClass("d-none");let s=Object.fromEntries(formTermination.serializeArray().map(({name:e,value:a})=>[e,a])),i=new Date(s.start_day),l=new Date(s.end_day);l.setDate(l.getDate()-1);let o=(l-i)/864e5;if($("#calculateTerminationBtn").html("Atualizar"),o<15)return a.removeClass("d-none"),t.addClass("d-none"),!1;let n={vacation:o%30>=15?Math.floor(o/30)+1:Math.floor(o/30),christmasBonus:1};if(i.getFullYear()===l.getFullYear())n.christmasBonus+=l.getMonth()-i.getMonth();else{let r=l.getFullYear()-i.getFullYear()-1;n.christmasBonus+=11-i.getMonth(),n.christmasBonus+=12*r,n.christmasBonus+=l.getMonth()+1}15>=l.getUTCDate()&&n.christmasBonus--;let u=new Date(i.valueOf());u.setUTCDate(u.getUTCDate()+15),u.getMonth()!==i.getMonth()&&n.christmasBonus--;let c=parseFloat((parseFloat(s.income_total)/o*30).toFixed(2)),m=c*(n.vacation/12),p=c*(n.christmasBonus/12),d=parseFloat((m/3).toFixed(2)),b=m+d+p;$("#salary").html(currency(c)),$("#christmasBonus").html(currency(p)),$("#totalGrossTermination").html(currency(b)),$(".monthsWorked").html(n.vacation),$("#monthsWorked").html(n.christmasBonus);let _=calcINSS(p),h=calcIRRF(p-_.discount);b+=_.discount-h.discount,$("#daysWorked").html(o+" dias"),$("#vacation").html(currency(m)),$("#vacationBonus").html(currency(d)),$("#incomeTerminationTotal").html(currency(b)),$("#percentInssTermination").html(_.taxe.toLocaleString("pt-br")),$("#inssTermination").html(currency(_.discount)),$("#percentIrrfTermination").html(h.taxe.toLocaleString("pt-br")),$("#irrfTermination").html(currency(h.discount)),t.removeClass("d-none"),window.location.href="#incomeTermination"}else e.stopPropagation();formTermination.addClass("was-validated")}),$("#changeMode").on("click",changeTheme),$('[data-bs-toggle="tooltip"]').toArray().map(e=>new bootstrap.Tooltip(e));